{"version":3,"file":"index.js","names":["runQueryUpdateFunction","mingoUpdater","incrementalUpdate","updateObj","incrementalModify","docData","newDocData","update","oldDocData","_data","_saveData","RxQueryUpdate","asRxQuery","doc","RxDBUpdatePlugin","name","rxdb","prototypes","RxDocument","proto","RxQuery"],"sources":["../../../../src/plugins/update/index.ts"],"sourcesContent":["/**\n * this plugin allows delta-updates with mongo-like-syntax\n * It's using mingo internally\n * @link https://github.com/kofrasa/mingo\n */\nimport { runQueryUpdateFunction } from '../../rx-query-helper.ts';\nimport type {\n    RxDocument,\n    RxQuery,\n    RxPlugin,\n    UpdateQuery\n} from '../../types/index.d.ts';\nimport { mingoUpdater } from './mingo-updater.ts';\n\nexport function incrementalUpdate<RxDocType>(\n    this: RxDocument<RxDocType>,\n    updateObj: UpdateQuery<RxDocType>\n): Promise<RxDocument<RxDocType>> {\n    return this.incrementalModify((docData) => {\n        const newDocData = mingoUpdater<RxDocType>(docData, updateObj);\n        return newDocData;\n    });\n}\n\nexport function update<RxDocType>(\n    this: RxDocument<RxDocType>,\n    updateObj: UpdateQuery<RxDocType>\n): Promise<RxDocument<RxDocType>> {\n    const oldDocData = this._data;\n    const newDocData = mingoUpdater(oldDocData, updateObj);\n    return this._saveData(newDocData, oldDocData);\n}\n\nexport async function RxQueryUpdate(\n    this: RxQuery,\n    updateObj: UpdateQuery<any>\n): Promise<any> {\n    return runQueryUpdateFunction(\n        this.asRxQuery,\n        (doc) => doc.update(updateObj),\n    );\n}\n\n\nexport const RxDBUpdatePlugin: RxPlugin = {\n    name: 'update',\n    rxdb: true,\n    prototypes: {\n        RxDocument: (proto: any) => {\n            proto.update = update;\n            proto.incrementalUpdate = incrementalUpdate;\n        },\n        RxQuery: (proto: any) => {\n            proto.update = RxQueryUpdate;\n        }\n    }\n};\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA,SAASA,sBAAsB,QAAQ,0BAA0B;AAOjE,SAASC,YAAY,QAAQ,oBAAoB;AAEjD,OAAO,SAASC,iBAAiBA,CAE7BC,SAAiC,EACH;EAC9B,OAAO,IAAI,CAACC,iBAAiB,CAAEC,OAAO,IAAK;IACvC,IAAMC,UAAU,GAAGL,YAAY,CAAYI,OAAO,EAAEF,SAAS,CAAC;IAC9D,OAAOG,UAAU;EACrB,CAAC,CAAC;AACN;AAEA,OAAO,SAASC,MAAMA,CAElBJ,SAAiC,EACH;EAC9B,IAAMK,UAAU,GAAG,IAAI,CAACC,KAAK;EAC7B,IAAMH,UAAU,GAAGL,YAAY,CAACO,UAAU,EAAEL,SAAS,CAAC;EACtD,OAAO,IAAI,CAACO,SAAS,CAACJ,UAAU,EAAEE,UAAU,CAAC;AACjD;AAEA,OAAO,eAAeG,aAAaA,CAE/BR,SAA2B,EACf;EACZ,OAAOH,sBAAsB,CACzB,IAAI,CAACY,SAAS,EACbC,GAAG,IAAKA,GAAG,CAACN,MAAM,CAACJ,SAAS,CACjC,CAAC;AACL;AAGA,OAAO,IAAMW,gBAA0B,GAAG;EACtCC,IAAI,EAAE,QAAQ;EACdC,IAAI,EAAE,IAAI;EACVC,UAAU,EAAE;IACRC,UAAU,EAAGC,KAAU,IAAK;MACxBA,KAAK,CAACZ,MAAM,GAAGA,MAAM;MACrBY,KAAK,CAACjB,iBAAiB,GAAGA,iBAAiB;IAC/C,CAAC;IACDkB,OAAO,EAAGD,KAAU,IAAK;MACrBA,KAAK,CAACZ,MAAM,GAAGI,aAAa;IAChC;EACJ;AACJ,CAAC","ignoreList":[]}